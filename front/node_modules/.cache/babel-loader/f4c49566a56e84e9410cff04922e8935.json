{"ast":null,"code":"/*\n * @author  Don Park\n * @version 0.2\n * @date    January 21th, 2007\n *\n * (The MIT License)\n *\n * Copyright (c) 2007-2012 Don Park <donpark@docuverse.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\nvar crypto = require('crypto');\n\nvar isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\nvar Canvas = isBrowser ? require('./lib/canvas') : require('canvas');\nvar patch0 = new Array(0, 4, 24, 20);\nvar patch1 = new Array(0, 4, 20);\nvar patch2 = new Array(2, 24, 20);\nvar patch3 = new Array(0, 2, 20, 22);\nvar patch4 = new Array(2, 14, 22, 10);\nvar patch5 = new Array(0, 14, 24, 22);\nvar patch6 = new Array(2, 24, 22, 13, 11, 22, 20);\nvar patch7 = new Array(0, 14, 22);\nvar patch8 = new Array(6, 8, 18, 16);\nvar patch9 = new Array(4, 20, 10, 12, 2);\nvar patch10 = new Array(0, 2, 12, 10);\nvar patch11 = new Array(10, 14, 22);\nvar patch12 = new Array(20, 12, 24);\nvar patch13 = new Array(10, 2, 12);\nvar patch14 = new Array(0, 2, 10);\nvar patchTypes = new Array(patch0, patch1, patch2, patch3, patch4, patch5, patch6, patch7, patch8, patch9, patch10, patch11, patch12, patch13, patch14, patch0);\nvar centerPatchTypes = new Array(0, 4, 8, 15);\n\nfunction render_identicon_patch(ctx, x, y, size, patch, turn, invert, foreColor, backColor) {\n  patch %= patchTypes.length;\n  turn %= 4;\n\n  if (patch == 15) {\n    invert = !invert;\n  }\n\n  var vertices = patchTypes[patch];\n  var offset = size / 2;\n  var scale = size / 4;\n  ctx.save(); // paint background\n\n  ctx.fillStyle = invert ? foreColor : backColor;\n  ctx.fillRect(x, y, size, size); // build patch path\n\n  ctx.translate(x + offset, y + offset);\n  ctx.rotate(turn * Math.PI / 2);\n  ctx.beginPath();\n  ctx.moveTo(vertices[0] % 5 * scale - offset, Math.floor(vertices[0] / 5) * scale - offset);\n\n  for (var i = 1; i < vertices.length; i++) ctx.lineTo(vertices[i] % 5 * scale - offset, Math.floor(vertices[i] / 5) * scale - offset);\n\n  ctx.closePath(); // offset and rotate coordinate space by patch position (x, y) and\n  // 'turn' before rendering patch shape\n  // render rotated patch using fore color (back color if inverted)\n\n  ctx.fillStyle = invert ? backColor : foreColor;\n  ctx.fill(); // restore rotation\n\n  ctx.restore();\n}\n\nfunction render_identicon(ctx, code, size) {\n  var patchSize = size / 3;\n  var middleType = centerPatchTypes[code & 3];\n  var middleInvert = (code >> 2 & 1) != 0;\n  var cornerType = code >> 3 & 15;\n  var cornerInvert = (code >> 7 & 1) != 0;\n  var cornerTurn = code >> 8 & 3;\n  var sideType = code >> 10 & 15;\n  var sideInvert = (code >> 14 & 1) != 0;\n  var sideTurn = code >> 15 & 3;\n  var blue = code >> 16 & 31;\n  var green = code >> 21 & 31;\n  var red = code >> 27 & 31;\n  var foreColor = 'rgb(' + (red << 3) + ',' + (green << 3) + ',' + (blue << 3) + ')';\n  var backColor = 'rgb(255,255,255)'; // middle patch\n\n  render_identicon_patch(ctx, patchSize, patchSize, patchSize, middleType, 0, middleInvert, foreColor, backColor); // side patchs, starting from top and moving clock-wise\n\n  render_identicon_patch(ctx, patchSize, 0, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n  render_identicon_patch(ctx, patchSize * 2, patchSize, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n  render_identicon_patch(ctx, patchSize, patchSize * 2, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n  render_identicon_patch(ctx, 0, patchSize, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor); // corner patchs, starting from top left and moving clock-wise\n\n  render_identicon_patch(ctx, 0, 0, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n  render_identicon_patch(ctx, patchSize * 2, 0, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n  render_identicon_patch(ctx, patchSize * 2, patchSize * 2, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n  render_identicon_patch(ctx, 0, patchSize * 2, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n}\n\nfunction _gen(str, size, callback) {\n  var hash = crypto.createHash('sha1').update(Buffer.from(str, 'utf8')).digest('binary');\n  var code = hash.charCodeAt(0) << 24 | hash.charCodeAt(1) << 16 | hash.charCodeAt(2) << 8 | hash.charCodeAt(3);\n  var canvas = isBrowser ? new Canvas(size, size) : Canvas.createCanvas(size, size);\n  var ctx = canvas.getContext('2d');\n  render_identicon(ctx, code, size);\n\n  if (callback && typeof callback === 'function') {\n    if (!canvas.toBuffer) {\n      var imageData = ctx.getImageData(0, 0, size, size);\n      callback(null, canvas.toDataURL('image/png'));\n      return;\n    }\n\n    return canvas.toBuffer(function (err, buffer) {\n      callback(err, buffer);\n    });\n  } else {\n    if (!canvas.toBuffer) {\n      return canvas.toDataURL('image/png');\n    }\n\n    return canvas.toBuffer();\n  }\n}\n\nexports.generate = exports.gen = function (str, size, callback) {\n  if (typeof str === 'object' && typeof size === 'function') {\n    return _gen(str.id, str.size, size);\n  }\n\n  return _gen(str, size, callback);\n};\n\nexports.generateSync = exports.genSync = function (str, size) {\n  if (typeof str === 'object') {\n    return _gen(str.id, str.size);\n  }\n\n  return _gen(str, size);\n};","map":{"version":3,"sources":["/Users/gmore/Sites/blablabla/front/node_modules/identicon/identicon.js"],"names":["crypto","require","isBrowser","window","document","Canvas","patch0","Array","patch1","patch2","patch3","patch4","patch5","patch6","patch7","patch8","patch9","patch10","patch11","patch12","patch13","patch14","patchTypes","centerPatchTypes","render_identicon_patch","ctx","x","y","size","patch","turn","invert","foreColor","backColor","length","vertices","offset","scale","save","fillStyle","fillRect","translate","rotate","Math","PI","beginPath","moveTo","floor","i","lineTo","closePath","fill","restore","render_identicon","code","patchSize","middleType","middleInvert","cornerType","cornerInvert","cornerTurn","sideType","sideInvert","sideTurn","blue","green","red","_gen","str","callback","hash","createHash","update","Buffer","from","digest","charCodeAt","canvas","createCanvas","getContext","toBuffer","imageData","getImageData","toDataURL","err","buffer","exports","generate","gen","id","generateSync","genSync"],"mappings":"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","sourcesContent":["/*\n * @author  Don Park\n * @version 0.2\n * @date    January 21th, 2007\n *\n * (The MIT License)\n *\n * Copyright (c) 2007-2012 Don Park <donpark@docuverse.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * 'Software'), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\nvar crypto = require('crypto');\nvar isBrowser = typeof window !== 'undefined' && typeof window.document !== 'undefined';\nvar Canvas = isBrowser ? require('./lib/canvas') : require('canvas');\n\nvar patch0 = new Array(0, 4, 24, 20);\nvar patch1 = new Array(0, 4, 20);\nvar patch2 = new Array(2, 24, 20);\nvar patch3 = new Array(0, 2,  20, 22);\nvar patch4 = new Array(2, 14, 22, 10);\nvar patch5 = new Array(0, 14, 24, 22);\nvar patch6 = new Array(2, 24, 22, 13, 11, 22, 20);\nvar patch7 = new Array(0, 14, 22);\nvar patch8 = new Array(6, 8, 18, 16);\nvar patch9 = new Array(4, 20, 10, 12, 2);\nvar patch10 = new Array(0, 2, 12, 10);\nvar patch11 = new Array(10, 14, 22);\nvar patch12 = new Array(20, 12, 24);\nvar patch13 = new Array(10, 2, 12);\nvar patch14 = new Array(0, 2, 10);\n\nvar patchTypes = new Array(patch0, patch1, patch2, patch3, patch4, patch5, patch6, patch7, patch8, patch9, patch10, patch11, patch12, patch13, patch14, patch0);\nvar centerPatchTypes = new Array(0, 4, 8, 15);\n\nfunction render_identicon_patch (ctx, x, y, size, patch, turn, invert, foreColor, backColor) {\n\n    patch %= patchTypes.length;\n    turn %= 4;\n    if (patch == 15) {\n        invert = !invert;\n    }\n\n    var vertices = patchTypes[patch];\n    var offset = size / 2;\n    var scale = size / 4;\n\n    ctx.save();\n\n    // paint background\n    ctx.fillStyle = invert ? foreColor : backColor;\n    ctx.fillRect(x, y, size, size);\n\n    // build patch path\n    ctx.translate(x + offset, y + offset);\n    ctx.rotate(turn * Math.PI / 2);\n    ctx.beginPath();\n    ctx.moveTo((vertices[0] % 5 * scale - offset), (Math.floor(vertices[0] / 5) * scale - offset));\n    for (var i = 1; i < vertices.length; i++)\n    ctx.lineTo((vertices[i] % 5 * scale - offset), (Math.floor(vertices[i] / 5) * scale - offset));\n    ctx.closePath();\n\n    // offset and rotate coordinate space by patch position (x, y) and\n    // 'turn' before rendering patch shape\n\n    // render rotated patch using fore color (back color if inverted)\n    ctx.fillStyle = invert ? backColor : foreColor;\n    ctx.fill();\n\n    // restore rotation\n    ctx.restore();\n}\n\nfunction render_identicon (ctx, code, size) {\n\n    var patchSize = size / 3;\n    var middleType = centerPatchTypes[code & 3];\n    var middleInvert = ((code >> 2) & 1) != 0;\n    var cornerType = (code >> 3) & 15;\n    var cornerInvert = ((code >> 7) & 1) != 0;\n    var cornerTurn = (code >> 8) & 3;\n    var sideType = (code >> 10) & 15;\n    var sideInvert = ((code >> 14) & 1) != 0;\n    var sideTurn = (code >> 15) & 3;\n    var blue = (code >> 16) & 31;\n    var green = (code >> 21) & 31;\n    var red = (code >> 27) & 31;\n    var foreColor = 'rgb(' + (red << 3) + ',' + (green << 3) + ',' + (blue << 3) + ')';\n    var backColor = 'rgb(255,255,255)';\n\n    // middle patch\n    render_identicon_patch(ctx, patchSize, patchSize, patchSize, middleType, 0, middleInvert, foreColor, backColor);\n\n    // side patchs, starting from top and moving clock-wise\n    render_identicon_patch(ctx, patchSize, 0, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n    render_identicon_patch(ctx, patchSize * 2, patchSize, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n    render_identicon_patch(ctx, patchSize, patchSize * 2, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n    render_identicon_patch(ctx, 0, patchSize, patchSize, sideType, sideTurn++, sideInvert, foreColor, backColor);\n\n    // corner patchs, starting from top left and moving clock-wise\n    render_identicon_patch(ctx, 0, 0, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n    render_identicon_patch(ctx, patchSize * 2, 0, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n    render_identicon_patch(ctx, patchSize * 2, patchSize * 2, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n    render_identicon_patch(ctx, 0, patchSize * 2, patchSize, cornerType, cornerTurn++, cornerInvert, foreColor, backColor);\n}\n\nfunction _gen(str, size, callback) {\n    var hash = crypto.createHash('sha1').update(Buffer.from(str, 'utf8')).digest('binary');\n    var code = (hash.charCodeAt(0) << 24) | (hash.charCodeAt(1) << 16) |\n    (hash.charCodeAt(2) << 8) | hash.charCodeAt(3);\n\n    var canvas = isBrowser ? new Canvas(size, size) : Canvas.createCanvas(size, size);\n    var ctx = canvas.getContext('2d');\n\n    render_identicon(ctx, code, size);\n\n    if (callback && typeof callback === 'function') {\n        if (!canvas.toBuffer) {\n            var imageData = ctx.getImageData(0, 0, size, size);\n            callback(null, canvas.toDataURL('image/png'));\n            return;\n        }\n        return canvas.toBuffer(function (err, buffer) {\n            callback(err, buffer);\n        });\n    }\n    else {\n        if (!canvas.toBuffer) {\n            return canvas.toDataURL('image/png');\n        }\n        return canvas.toBuffer();\n    }\n}\n\nexports.generate = exports.gen = function (str, size, callback) {\n    if (typeof str === 'object' && typeof size === 'function') {\n        return _gen(str.id, str.size, size);\n    }\n\n    return _gen(str, size, callback);\n}\n\nexports.generateSync = exports.genSync = function (str, size) {\n    if (typeof str === 'object') {\n        return _gen(str.id, str.size);\n    }\n\n    return _gen(str, size);\n}\n"]},"metadata":{},"sourceType":"script"}